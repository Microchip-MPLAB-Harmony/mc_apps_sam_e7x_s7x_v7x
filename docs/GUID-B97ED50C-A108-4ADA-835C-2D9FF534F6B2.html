<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="MCHV3 Development Board - Setup and Running 'PMSM FOC Quadrature Encoder Application'" />
<meta name="DC.relation" scheme="URI" content="GUID-E85C1437-2BD1-4479-8771-DF04C24476EB.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="mchv3-development-board---setup-and-running-pmsm-foc-quadrature-encoder-application" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>MCHV3 Development Board - Setup and Running 'PMSM FOC Quadrature Encoder Application'</title>
<meta name="Microsoft.Help.Id" content="GUID-A4FA5B29-A18C-4B66-B6FE-172C03A7301B-mchv3-development-board---setup-and-running-pmsm-foc-quadrature-encoder-application" />
<meta name="Microsoft.Help.TocParent" content="GUID-A4FA5B29-A18C-4B66-B6FE-172C03A7301B" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony 3 Motor Control Applications for SAM E7x/V7x/S7x family Please select a publication type A 10/2022" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-B97ED50C-A108-4ADA-835C-2D9FF534F6B2"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body id="mchv3-development-board---setup-and-running-pmsm-foc-quadrature-encoder-application">
<h1 class="title topictitle1" id="ariaid-title1">MCHV3 Development Board - Setup and Running 'PMSM FOC Quadrature Encoder Application'</h1><div class="body"><p class="p"><strong class="ph b">Setting up the hardware</strong></p>
<p class="p">The following table shows the target hardware for the application projects.</p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="text-align:left;vertical-align:middle;" id="d849e21"><span>Project Name</span></th>
<th class="entry cellrowborder" style="text-align:center;vertical-align:middle;" id="d849e23"><span>Hardware</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="text-align:left;vertical-align:middle;" headers="d849e21 "><span>mchv3_sam_e70_pim.X</span></td>
<td class="entry cellrowborder" style="text-align:center;vertical-align:middle;" headers="d849e23 "><span><a class="xref" href="https://www.microchip.com/developmenttools/ProductDetails/dm330023-3" target="_blank">MCHV3 Development Board</a><a class="xref" href="https://www.microchip.com/Developmenttools/ProductDetails/MA320203" target="_blank">ATSAME70 Plug-in module</a><a class="xref" href="https://www.microchip.com/developmenttools/ProductDetails/AC300025" target="_blank">Leadshine EL5-M0400-1-24 Motor</a> <a class="xref" href="https://www.microchip.com/DevelopmentTools/ProductDetails/AC320202" target="_blank">Isolated Embedded Debugger Interface</a></span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" colspan="2" style="text-align:left;vertical-align:middle;" headers="d849e21 d849e23 "><span>Â </span></td>
</tr>
</tbody>
</table>
</div>
<p class="p"><strong class="ph b">Setting up <a class="xref" href="https://www.microchip.com/developmenttools/ProductDetails/dm330023-3" target="_blank">MCHV3 Development Board</a></strong></p>
<ul class="ul"><li class="li with-image"><p class="p">Mount the ATSAME70 Motor Control Plug In Module on U9 header.</p>
<br /><img class="image" src="GUID-5B7EECF0-4E2E-41AE-AC90-B2E36010E3CB-low.jpg" alt="PIM Install" /><br /></li>
<li class="li with-image"><p class="p">Place the "PFC - External Opamp Configuration" Matrix board at J4.</p>
<br /><img class="image" src="GUID-AD0DF98E-86F7-43D3-9B3F-355D31893645-low.jpg" alt="External OPAMP" /><br /></li>
<li class="li with-image"><p class="p">Motor Connections:</p>
<ul class="ul"><li class="li"><p class="p">Phase U - M1</p>
</li>
<li class="li"><p class="p">Phase V - M2</p>
</li>
<li class="li"><p class="p">Phase W - M3</p>
</li>
</ul>
<br /><img class="image" src="GUID-7E3BFBA0-F563-4326-89D5-3FA74B288F39-low.png" alt="Motor Connections" /><br /></li>
<li class="li with-image"><p class="p">Encoder Connections:</p>
<ul class="ul"><li class="li"><p class="p">A+ - HA</p>
</li>
<li class="li"><p class="p">B+ - HB</p>
</li>
<li class="li"><p class="p">5V - +5V</p>
</li>
<li class="li"><p class="p">0V - GND</p>
</li>
</ul>
<br /><img class="image" src="GUID-E0ECA475-FCFC-400D-9B8F-824220158553-low.png" alt="Encoder Connections" /><br /></li>
<li class="li"><p class="p">Jumper Settings:</p>
<ul class="ul"><li class="li"><p class="p">J11 - VAC ( Short Pin 3 - 4)</p>
</li>
<li class="li"><p class="p">J12 - IA ( Short Pin 1 - 2)</p>
</li>
<li class="li"><p class="p">J13 - IB ( Short Pin 1 - 2)</p>
</li>
<li class="li"><p class="p">J14 - Fault_IP/IBUS ( Short Pin 1 - 2)</p>
</li>
</ul>
</li>
<li class="li with-image"><p class="p">Power the board with (110V/220V) AC mains. For additional safety, it is recommended to use a current limited power supply while testing this software demonstration on a non-default hardware and motor.</p>
<br /><img class="image" src="GUID-94349583-0C3E-42D2-ABE3-1F0C9AD1C98F-low.png" alt="jumper Settings" /><br /></li>
<li class="li with-image"><p class="p">Installing Isolated Embedded Debugger
Default programmer or debugger daughter card shipped with the MCHV3 board cannot program or debug SAM series MCU and therefore, it needs to be replaced with an Isolated Embedded Debugger Interface for MCHV.</p>
<br /><img class="image" src="GUID-61ECD694-5820-410A-8D03-FAC567F64BC5-low.png" alt="Isolated EDBG" /><br /></li>
<li class="li with-image"><p class="p">Complete Setup</p>
<br /><img class="image" src="GUID-F636A3BA-9FEB-46B9-8FF3-5A092A99F26C-low.jpg" alt="Setup" /><br /></li>
</ul>
<p class="p"><strong class="ph b">Running the Application</strong></p>
<ol class="ol"><li class="li"><span class="indent-level-default">1.</span><p class="p">Build and Program the application using its IDE</p>
</li>
<li class="li"><span class="indent-level-default">2.</span><p class="p">Press switch PUSHBUTTON to start the motor</p>
</li>
<li class="li"><span class="indent-level-default">3.</span><p class="p">Vary potentiometer to change the speed of the motor</p>
</li>
<li class="li"><span class="indent-level-default">4.</span><p class="p">Press switch to stop the motor</p>
</li>
<li class="li"><span class="indent-level-default">5.</span><p class="p">Monitor graphs on X2C Scope</p>
</li>
</ol>
<p class="p">Refer to the following tables for switch and LED details:</p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d849e160"><span>Switch</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d849e162"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d849e160 "><span>PUSHBUTTON</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d849e162 "><span>To start or stop the motor</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d849e160 "><span>Â </span></td>
</tr>
</tbody>
</table>
</div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d849e178"><span>LED D2 Status</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d849e180"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d849e178 "><span>OFF</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d849e180 "><span>No fault</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d849e178 "><span>ON</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d849e180 "><span>Fault is detected</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d849e178 "><span>Â </span></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-E85C1437-2BD1-4479-8771-DF04C24476EB.html">Hardware Setup</a></div>
</div>
</div></body>
</html>